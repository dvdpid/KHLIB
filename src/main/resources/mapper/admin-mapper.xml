<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="adminMapper">

	<!-- 도서 관련 -->
	<select id="getListCount" resultType="_int">
		select count(*)
		from books
		where b_Status='Y'
	</select>
	
	<select id="selectList" resultMap="booksResultSet">
		select *
		from books
		where b_status='Y'
		order by books_no desc
	</select>
	<resultMap type="Books" id="booksResultSet">
		<id column="BOOKS_NO" property="bNo"/>
		<result column="BOOK_TITLE" property="bTitle"/>
		<result column="BOOKS_WRITER" property="bWriter"/>
		<result column="BOOKS_COMPANY" property="bCompany"/>
		<result column="BOOKS_DATE" property="bDate"/>
		<result column="BOOKS_CONTENT" property="bContent"/>
		<result column="B_STATUS" property="bStatus"/>
		<result column="B_RECOMMEND" property="bRecommend"/>
		<result column="ENTRY_DATE" property="entryDate"/>
	</resultMap>
	
	<insert id="insertBook">
		insert into books
		values(seq_bkno.nextval, #{bTitle}, #{bWriter}, #{bCompany}, #{bDate}, #{bContent}, default, default, sysdate)
	</insert>
	<insert id="insertAttachment">
		insert into files
		values(seq_fno.nextval, #{originName}, #{changeName}, sysdate, 0, default, 0, 0, 0, seq_bkno.CURRVAL, 0)
	</insert>
	
	
	<!-- 문화마당 -->
	<select id="getcListCount" resultType="_int">
		select count(*)
		from culture
		where c_Status='Y'
	</select>
	<select id="selectCList" resultMap="cultureResultSet">
		select *
		from culture
		where c_status='Y'
		order by culture_no desc
	</select>
	<resultMap type="Culture" id="cultureResultSet">
		<id column="CULTURE_NO" property="cNo"/>
		<result column="CULTURE_TITLE" property="cTitle"/>
		<result column="CULTURE_CONTENT" property="cContent"/>
		<result column="CULTURE_TOTAL" property="cTotal"/>
		<result column="CULTURE_START_DATE" property="cStartDate"/>
		<result column="CULTURE_END_DATE" property="cEndDate"/>
		<result column="LECTURE_DATE" property="lDate"/>
		<result column="LECTURE_TIME" property="lTime"/>
		<result column="CULTURE_PLACE" property="cPlace"/>
		<result column="CULTURE_INSTRUCTOR" property="cInstructor"/>
		<result column="CULTURE_TARGET" property="cTarget"/>
		<result column="C_DEADLINE" property="cDateLine"/>
		<result column="C_STATUS" property="cStatus"/>
		<result column="USER_NO" property="uNo"/>
	</resultMap>
	
	<insert id="insertCulture">
		insert into culture
		values(seq_cno.nextval, #{cTitle}, #{cContent}, #{cTotal}, #{cStartDate}, #{cEndDate}, #{lDate}, #{lTime}, #{cPlace}, #{cInstructor}, #{cTarget}, default, default)
	</insert>
	<insert id="insertCultureAttachment">
		insert into files
		values(seq_fno.nextval, #{originName}, #{changeName}, sysdate, 0, default, 0, 0, seq_cno.CURRVAL, 0, 0)
	</insert>
	<insert id="insertCultureFile">
		insert into files
		values(seq_fno.nextval, #{originName}, #{changeName}, sysdate, 2, default, 0, 0, seq_cno.CURRVAL, 0, 0)
	</insert>
	
	<!-- 관리자 로그인 -->
	<select id="adminLogin" resultMap="memberResultSet">
		select *
		from users
		where user_id = #{id} and u_status='Y' and ADMIN_YN = 'Y'
	</select>
		<resultMap type="com.kh.klib.member.model.vo.Member" id="memberResultSet">
 		<id column="USER_NO" property="no"/>
 		<result column="USER_ID" property="id"/> 		
 		<result column="USER_PWD" property="pwd"/>
 		<result column="USER_NAME" property="name"/>
 		<result column="NICKNAME" property="nickname"/>
 		<result column="BIRTHDAY" property="birthday"/>
 		<result column="GENDER" property="gender"/>		
 		<result column="PHONE" property="phone"/>
 		<result column="EMAIL" property="email"/> 		
 		<result column="ADDRESS" property="address"/> 		
 		<result column="U_STATUS" property="uStatus"/>
 		<result column="ADMIN_YN" property="admin"/>
 	</resultMap>
	
	<!-- 관리자 회원가입 -->
	<insert id="insertAdmin">
		insert into users
 		values(seq_uno.nextval,#{id}, #{pwd}, #{name}, #{nickname},#{birthday}, #{gender}, #{phone},#{email},
 			#{address}, default, 'Y')
	</insert>
	<select id="dupId" resultType="_int">
		SELECT count(*)
		from users
		where user_id = #{id}
	</select>
	
	<!-- 유저 관련 -->
	<select id="getListUserCount" resultType="_int">
		select count(*)
		from users
		where u_Status='Y' and ADMIN_YN = 'N'
	</select>
	<select id="getListadminUserCount" resultType="_int">
		select count(*)
		from users
		where u_Status='Y' and ADMIN_YN = 'Y'
	</select>
	
	<select id="selectUserList" resultMap="MemberResultSet">
		select *
		from users
		where u_status='Y' and ADMIN_YN = 'N'
		order by USER_NO desc
	</select>
	<select id="selectadminUserList" resultMap="MemberResultSet">
		select *
		from users
		where u_status='Y' and ADMIN_YN = 'Y'
		order by USER_NO desc
	</select>
	
	<resultMap type="Member" id="MemberResultSet">
		<id column="USER_NO" property="no"/>
		<result column="USER_ID" property="id"/>
		<result column="USER_PWD" property="pwd"/>
		<result column="USER_NAME" property="name"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="BIRTHDAY" property="birthday"/>
		<result column="GENDER" property="gender"/>
		<result column="PHONE" property="phone"/>
		<result column="EMAIL" property="email"/>
		<result column="ADDRESS" property="address"/>
		<result column="U_STATUS" property="uStatus"/>
		<result column="ADMIN_YN" property="admin"/>
	</resultMap>
	
	<update id="deleteUser">
		update users
		set u_status='N'
		where user_no = #{no}
	</update>
	<update id="deleteAdmin">
		update users
		set u_status='N'
		where user_no = #{no}
	</update>
	
	
	<!-- 열람실 -->
	<select id="selectrList" resultMap="roomResultSet">
		select *
		from room
		order by room_no
	</select>
	<resultMap type="Room" id="roomResultSet">
		<id column="ROOM_NO" property="rNo"/>
		<result column="ROOM_STATUS" property="rStatus"/>
	</resultMap>
	
	<select id="getAllListCount" resultType="_int">
		select count(*)
		from room
	</select>
	
	<select id="getrlistCount" resultType="_int">
		select count(*)
		from room
		where room_status='Y'
	</select>
	
	<select id="getChk" resultType="_int">
		select count(*) 
		from room_sign
		    join room using(room_no)
		where user_no=#{uNo} and ((room_status='Y' and out_time is not null) or room_status='Y')
	</select>
	
	<select id="selectNick" resultMap="roomSignResultSet">
		select *
		from room_sign
		where room_no = #{rNo} and OUT_TIME is null
	</select>
	<resultMap type="RoomSign" id="roomSignResultSet">
		<id column="RS_NO" property="rsNo"/>
		<result column="IN_TIME" property="inTime"/>
		<result column="OUT_TIME" property="outTime"/>
		<result column="NICKNAME" property="nickName"/>
		<result column="ROOM_NO" property="rNo"/>
		<result column="USER_NO" property="uNo"/>
	</resultMap>
	
	<update id="cancelRoom">
		update room
		set room_status = 'N'
		where room_no = #{rNo}
	</update>
	<update id="outTime">
		update room_sign
		set out_time = sysdate
		where rs_no = #{rsNo}
	</update>
	
</mapper>